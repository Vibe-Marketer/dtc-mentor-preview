"use strict";(()=>{var e={};e.id=725,e.ids=[725],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5025:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{POST:()=>u});var o=r(9303),s=r(8716),n=r(670),i=r(7070);async function u(e){try{let{shop:t,accessToken:r}=await e.json();if(!t||!r)return i.NextResponse.json({error:"Shop and accessToken required"},{status:400});let a=`https://${t}/admin/api/2024-01`,o={"X-Shopify-Access-Token":r,"Content-Type":"application/json"},s=new Date;s.setDate(s.getDate()-90);let n=await fetch(`${a}/orders.json?status=any&created_at_min=${s.toISOString()}&limit=250`,{headers:o}),u=(await n.json()).orders||[],c=await fetch(`${a}/customers/count.json`,{headers:o}),p=await c.json(),d=await fetch(`${a}/products/count.json`,{headers:o}),l=await d.json(),h=new Date;h.setDate(h.getDate()-30);let m=new Date;m.setDate(m.getDate()-60);let f=u.filter(e=>new Date(e.created_at)>=h),w=u.filter(e=>{let t=new Date(e.created_at);return t>=m&&t<h}),g=f.reduce((e,t)=>e+parseFloat(t.total_price),0),j=w.reduce((e,t)=>e+parseFloat(t.total_price),0),v=u.reduce((e,t)=>e+parseFloat(t.total_price),0),y=f.length>0?g/f.length:0,x=new Set(u.filter(e=>e.customer?.orders_count>1).map(e=>e.customer?.id)),D=new Set(u.map(e=>e.customer?.id)),M=D.size>0?x.size/D.size*100:0,R=f.filter(e=>e.customer?.orders_count===1).length,_={totalRevenue30d:Math.round(100*g)/100,totalRevenue90d:Math.round(100*v)/100,totalOrders30d:f.length,totalOrders90d:u.length,aov:Math.round(100*y)/100,totalCustomers:p.count||0,newCustomers30d:R,repeatCustomerRate:Math.round(10*M)/10,totalProducts:l.count||0,estimatedMonthlyRevenue:Math.round(100*g)/100,revenueGrowth:Math.round(10*(j>0?(g-j)/j*100:0))/10};return i.NextResponse.json({metrics:_})}catch(e){return console.error("Metrics error:",e),i.NextResponse.json({error:"Failed to fetch metrics"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/shopify/metrics/route",pathname:"/api/shopify/metrics",filename:"route",bundlePath:"app/api/shopify/metrics/route"},resolvedPagePath:"/Users/administrator/.openclaw/workspace/dtc-mentor/app/api/shopify/metrics/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:l}=c,h="/api/shopify/metrics/route";function m(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(5025));module.exports=a})();